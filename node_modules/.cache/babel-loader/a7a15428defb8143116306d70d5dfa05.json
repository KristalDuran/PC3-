{"ast":null,"code":"var __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0) t[p[i]] = s[p[i]];\n  return t;\n};\n\nimport { findMidPointOfPolygon, Rect, filter, getTemplateFunction, getZoomTranslate, getTranslate, RectOption, convertElementFromLabel, Point, TextOption, renderTextElement, textTrim, measureText, Internalize } from '../utils/helper';\nimport { isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { dataLabelRendering } from '../model/constants';\n/**\n * DataLabel Module used to render the maps datalabel\n */\n\nvar DataLabel =\n/** @class */\nfunction () {\n  function DataLabel(maps) {\n    this.value = {\n      rightWidth: 0,\n      leftWidth: 0,\n      heightTop: 0,\n      heightBottom: 0\n    };\n    this.maps = maps;\n    this.dataLabelCollections = [];\n  } //tslint:disable:max-func-body-length\n\n\n  DataLabel.prototype.getDataLabel = function (dataSource, labelPath, shapeName, shapeDataPath) {\n    var text;\n    var shapeNameValue;\n\n    for (var i = 0; i < dataSource.length; i++) {\n      var data = dataSource[i];\n      var dataShapePathValue = void 0;\n      dataShapePathValue = !isNullOrUndefined(data[shapeDataPath]) && isNaN(data[shapeDataPath]) ? data[shapeDataPath].toLowerCase() : data[shapeDataPath];\n      shapeName = !isNullOrUndefined(shapeName) ? shapeName.toString() : shapeName;\n      shapeNameValue = !isNullOrUndefined(shapeName) ? shapeName.toLowerCase() : shapeName;\n\n      if (dataShapePathValue === shapeNameValue) {\n        text = data;\n        break;\n      }\n    }\n\n    return text;\n  };\n  /**\n   * To render label for maps\n   * @param layer\n   * @param layerIndex\n   * @param shape\n   * @param layerData\n   * @param group\n   * @param labelTemplateElement\n   * @param index\n   */\n\n\n  DataLabel.prototype.renderLabel = function (layer, layerIndex, shape, layerData, group, labelTemplateElement, index, intersect) {\n    var _this = this;\n\n    var dataLabel = layer.dataLabelSettings;\n    var style = layer.dataLabelSettings.textStyle;\n    var markerEle;\n    var templateFn;\n    var options;\n    var dataLabelSettings = layer.dataLabelSettings;\n    var labelpath = layer.dataLabelSettings.labelPath;\n    var shapePoint = [[]];\n    var midIndex = 0;\n    var pointsLength = 0;\n    var shapeData = shape;\n    var element;\n    var data;\n    var text = '';\n    var datasrcObj;\n    var currentLength = 0;\n    var oldIndex;\n    var location;\n    var sublayerIndexLabel = false;\n    var shapeProperties = shape['properties'];\n    var labelId = this.maps.element.id + '_LayerIndex_' + layerIndex + '_shapeIndex_' + index + '_LabelIndex_' + index;\n    var textLocation = new Point(0, 0);\n    /* tslint:disable:no-string-literal */\n\n    var shapes = layerData[index];\n    var locationX;\n    var locationY;\n    style.fontFamily = this.maps.theme.toLowerCase() !== 'material' ? this.maps.themeStyle.labelFontFamily : style.fontFamily;\n    shape = shapes['property'];\n    var properties = Object.prototype.toString.call(layer.shapePropertyPath) === '[object Array]' ? layer.shapePropertyPath : [layer.shapePropertyPath];\n    var propertyPath;\n    var isPoint = false;\n    var animate = layer.animationDuration !== 0 || isNullOrUndefined(this.maps.zoomModule);\n    var translate = this.maps.isTileMap ? new Object() : this.maps.zoomSettings.zoomFactor > 1 && !isNullOrUndefined(this.maps.zoomModule) ? getZoomTranslate(this.maps, layer, animate) : getTranslate(this.maps, layer, animate);\n    var scale = this.maps.isTileMap ? this.maps.scale : translate['scale'];\n    var transPoint = this.maps.isTileMap ? this.maps.translatePoint : translate['location'];\n    var zoomTransPoint = this.maps.zoomTranslatePoint;\n    var shapeWidth;\n    var scaleZoomValue = !isNullOrUndefined(this.maps.scale) ? Math.floor(this.maps.scale) : 1;\n    var zoomLabelsPosition = this.maps.zoomSettings.enable ? !isNullOrUndefined(this.maps.zoomShapeCollection) && this.maps.zoomShapeCollection.length > 0 : this.maps.zoomSettings.enable;\n    this.maps.translateType = 'labels';\n\n    for (var j = 0; j < properties.length; j++) {\n      if (shapeProperties[properties[j]]) {\n        propertyPath = properties[j];\n        datasrcObj = this.getDataLabel(layer.dataSource, layer.shapeDataPath, shapeData['properties'][propertyPath], layer.shapeDataPath);\n\n        if (datasrcObj) {\n          break;\n        }\n      }\n    }\n\n    datasrcObj = this.getDataLabel(layer.dataSource, layer.shapeDataPath, shapeData['properties'][propertyPath], layer.shapeDataPath);\n\n    if (!isNullOrUndefined(shapes['property'])) {\n      shapePoint = [[]];\n\n      if (!layerData[index]['_isMultiPolygon'] && layerData[index]['type'] !== 'Point') {\n        shapePoint.push(this.getPoint(layerData[index], []));\n        currentLength = shapePoint[shapePoint.length - 1].length;\n\n        if (pointsLength < currentLength) {\n          pointsLength = currentLength;\n          midIndex = shapePoint.length - 1;\n        }\n      } else {\n        var layer_1 = layerData[index];\n\n        if (layer_1['type'] === 'Point') {\n          isPoint = true;\n          var layerPoints = [];\n          layerPoints.push(this.getPoint(layerData, []));\n          shapePoint = layerPoints;\n          currentLength = shapePoint[shapePoint.length - 1].length;\n\n          if (pointsLength < currentLength) {\n            pointsLength = currentLength;\n            midIndex = shapePoint.length - 1;\n          }\n        }\n\n        for (var j = 0; j < layer_1.length; j++) {\n          shapePoint.push(this.getPoint(layer_1[j], []));\n          currentLength = shapePoint[shapePoint.length - 1].length;\n\n          if (pointsLength < currentLength) {\n            pointsLength = currentLength;\n            midIndex = shapePoint.length - 1;\n          }\n        }\n      }\n    }\n\n    text = !isNullOrUndefined(datasrcObj) ? !isNullOrUndefined(datasrcObj[labelpath]) ? datasrcObj[layer.shapeDataPath].toString() : datasrcObj[layer.shapeDataPath] : shapeData['properties'][labelpath];\n\n    if (Object.prototype.toString.call(layer.shapePropertyPath) === '[object Array]' && isNullOrUndefined(text) && layer.dataSource['length'] === 0) {\n      for (var l = 0; l < layer.shapePropertyPath.length; l++) {\n        if (shapeData['properties'][layer.shapePropertyPath[l]]) {\n          text = shapeData['properties'][layer.shapePropertyPath[l]];\n          break;\n        }\n      }\n    }\n\n    if (isNullOrUndefined(text) && layer.dataLabelSettings.template !== \"\" && layer.dataSource['length'] === 0) {\n      text = shapeData['properties'][layer.shapePropertyPath];\n    }\n\n    var dataLabelText = text;\n    var projectionType = this.maps.projectionType;\n\n    if (isPoint) {\n      location = {\n        x: shapePoint[midIndex][index]['x'],\n        y: shapePoint[midIndex][index]['y'],\n        rightMin: 0,\n        rightMax: 0,\n        leftMin: 0,\n        leftMax: 0,\n        points: shapePoint[midIndex][index],\n        topMax: 0,\n        topMin: 0,\n        bottomMax: 0,\n        bottomMin: 0,\n        height: 0\n      };\n    } else {\n      location = findMidPointOfPolygon(shapePoint[midIndex], projectionType);\n    }\n\n    var firstLevelMapLocation = location;\n\n    if (!isNullOrUndefined(text) && !isNullOrUndefined(location)) {\n      if (zoomLabelsPosition && scaleZoomValue > 1 && !this.maps.zoomNotApplied && dataLabel.template === '') {\n        if (layerIndex > 0) {\n          for (var k = 0; k < this.maps.zoomLabelPositions.length; k++) {\n            if (this.maps.zoomLabelPositions[k]['dataLabelText'] === text) {\n              oldIndex = index;\n              index = k;\n              sublayerIndexLabel = true;\n              break;\n            }\n          }\n        }\n\n        locationX = location['x'];\n        locationY = location['y'];\n        location['x'] = (location['x'] + zoomTransPoint['x']) * scale;\n        location['y'] = (location['y'] + zoomTransPoint['y']) * scale;\n      }\n\n      location['y'] = this.maps.projectionType === 'Mercator' ? location['y'] : -location['y'];\n      data = location;\n\n      if (!isNullOrUndefined(this.maps.format) && !isNaN(parseFloat(text))) {\n        if (this.maps.useGroupingSeparator) {\n          text = Internalize(this.maps, parseFloat(text));\n\n          if (!isNullOrUndefined(datasrcObj)) {\n            datasrcObj[labelpath] = text;\n          }\n        }\n      }\n\n      var eventargs_1 = {\n        name: dataLabelRendering,\n        maps: this.maps,\n        cancel: false,\n        border: dataLabel.border,\n        datalabel: dataLabel,\n        fill: dataLabel.fill,\n        template: dataLabel.template,\n        text: text\n      };\n\n      if (this.maps.isBlazor) {\n        var maps = eventargs_1.maps,\n            datalabel = eventargs_1.datalabel,\n            blazorEventArgs = __rest(eventargs_1, [\"maps\", \"datalabel\"]);\n\n        eventargs_1 = blazorEventArgs;\n      }\n\n      this.maps.trigger('dataLabelRendering', eventargs_1, function (labelArgs) {\n        if (eventargs_1.cancel) {\n          return;\n        }\n\n        var border = {\n          color: 'yellow'\n        };\n        var position = [];\n        var width = zoomLabelsPosition && scaleZoomValue > 1 && !_this.maps.zoomNotApplied && _this.maps.zoomShapeCollection.length > index ? _this.maps.zoomShapeCollection[index]['width'] : (location['rightMax']['x'] - location['leftMax']['x']) * scale;\n\n        if (!isNullOrUndefined(_this.maps.dataLabelShape)) {\n          shapeWidth = firstLevelMapLocation['rightMax']['x'] - firstLevelMapLocation['leftMax']['x'];\n\n          _this.maps.dataLabelShape.push(shapeWidth);\n        }\n\n        if (eventargs_1.text !== text && !eventargs_1.cancel) {\n          text = eventargs_1.text;\n        }\n\n        var textSize = measureText(text, style);\n        var trimmedLable = text;\n        var elementSize = textSize;\n        var startY = location['y'] - textSize['height'] / 4;\n        var endY = location['y'] + textSize['height'] / 4;\n        var start = (location['y'] + transPoint['y']) * scale - textSize['height'] / 4;\n        var end = (location['y'] + transPoint['y']) * scale + textSize['height'] / 4;\n        position = filter(shapePoint[midIndex], startY, endY);\n\n        if (!isPoint && position.length > 5 && shapeData['geometry']['type'] !== 'MultiPolygon' && shapeData['type'] !== 'MultiPolygon') {\n          var location1 = findMidPointOfPolygon(position, projectionType);\n\n          if (zoomLabelsPosition && scaleZoomValue > 1 && !_this.maps.zoomNotApplied && eventargs_1.template === '') {\n            location1['x'] = (_this.maps.zoomLabelPositions[index]['location']['x'] + zoomTransPoint['x']) * scale;\n            location1['y'] = (_this.maps.zoomLabelPositions[index]['location']['y'] + zoomTransPoint['y']) * scale;\n          }\n\n          locationX = location1['x'];\n          location['x'] = location1['x'];\n          width = zoomLabelsPosition && scaleZoomValue > 1 && !_this.maps.zoomNotApplied && _this.maps.zoomShapeCollection.length > index ? _this.maps.zoomShapeCollection[index]['width'] : (location1['rightMax']['x'] - location1['leftMax']['x']) * scale;\n        }\n\n        var xpositionEnds = (location['x'] + transPoint['x']) * scale + textSize['width'] / 2;\n        var xpositionStart = (location['x'] + transPoint['x']) * scale - textSize['width'] / 2;\n        _this.value[index] = {\n          rightWidth: xpositionEnds,\n          leftWidth: xpositionStart,\n          heightTop: start,\n          heightBottom: end\n        };\n        var labelElement;\n\n        if (eventargs_1.template !== '') {\n          templateFn = getTemplateFunction(eventargs_1.template);\n          var templateElement = templateFn ? templateFn(!isNullOrUndefined(datasrcObj) ? datasrcObj : shapeData['properties'], null, null, _this.maps.element.id + '_LabelTemplate', false) : document.createElement('div');\n          templateElement.innerHTML = !templateFn ? eventargs_1.template : '';\n          labelElement = convertElementFromLabel(templateElement, labelId, !isNullOrUndefined(datasrcObj) ? datasrcObj : shapeData['properties'], index, _this.maps);\n          labelElement.style.left = Math.abs(_this.maps.baseMapRectBounds['min']['x'] - location['x']) * scale + 'px';\n          labelElement.style.top = Math.abs(_this.maps.baseMapRectBounds['min']['y'] - location['y']) * scale + 'px';\n          labelTemplateElement.appendChild(labelElement);\n        } else {\n          if (dataLabelSettings.smartLabelMode === 'Trim') {\n            trimmedLable = textTrim(width, text, style);\n            elementSize = measureText(trimmedLable, style);\n            options = new TextOption(labelId, textLocation.x, textLocation.y, 'middle', trimmedLable, '', '');\n          }\n\n          if (dataLabelSettings.smartLabelMode === 'None') {\n            options = new TextOption(labelId, textLocation.x, textLocation.y, 'middle', text, '', '');\n          }\n\n          if (dataLabelSettings.smartLabelMode === 'Hide') {\n            text = width >= textSize['width'] ? text : '';\n            options = new TextOption(labelId, textLocation.x, textLocation.y, 'middle', text, '', '');\n          }\n\n          text = options['text'];\n\n          if (dataLabelSettings.intersectionAction === 'Hide') {\n            for (var i = 0; i < intersect.length; i++) {\n              if (!isNullOrUndefined(intersect[i])) {\n                if (_this.value[index]['leftWidth'] > intersect[i]['rightWidth'] || _this.value[index]['rightWidth'] < intersect[i]['leftWidth'] || _this.value[index]['heightTop'] > intersect[i]['heightBottom'] || _this.value[index]['heightBottom'] < intersect[i]['heightTop']) {\n                  text = text;\n                } else {\n                  text = '';\n                  break;\n                }\n              }\n            }\n\n            intersect.push(_this.value[index]);\n            options = new TextOption(labelId, textLocation.x, textLocation.y, 'middle', text, '', '');\n          }\n\n          var difference = void 0;\n\n          if (dataLabelSettings.intersectionAction === 'Trim') {\n            for (var j = 0; j < intersect.length; j++) {\n              if (!isNullOrUndefined(intersect[j])) {\n                if (intersect[j]['rightWidth'] < _this.value[index]['leftWidth'] || intersect[j]['leftWidth'] > _this.value[index]['rightWidth'] || intersect[j]['heightBottom'] < _this.value[index]['heightTop'] || intersect[j]['heightTop'] > _this.value[index]['heightBottom']) {\n                  trimmedLable = text;\n                  difference = 0;\n                } else {\n                  if (_this.value[index]['leftWidth'] > intersect[j]['leftWidth']) {\n                    width = intersect[j]['rightWidth'] - _this.value[index]['leftWidth'];\n                    difference = width - (_this.value[index]['rightWidth'] - _this.value[index]['leftWidth']);\n                    trimmedLable = textTrim(difference, text, style);\n                    break;\n                  }\n\n                  if (_this.value[index]['leftWidth'] < intersect[j]['leftWidth']) {\n                    width = _this.value[index]['rightWidth'] - intersect[j]['leftWidth'];\n                    difference = Math.abs(width - (_this.value[index]['rightWidth'] - _this.value[index]['leftWidth']));\n                    trimmedLable = textTrim(difference, text, style);\n                    break;\n                  }\n                }\n              }\n            }\n\n            elementSize = measureText(trimmedLable, style);\n            intersect.push(_this.value[index]);\n            options = new TextOption(labelId, textLocation.x, textLocation.y, 'middle', trimmedLable, '', '');\n          }\n\n          if (dataLabelSettings.intersectionAction === 'None') {\n            options = new TextOption(labelId, textLocation.x, textLocation.y, 'middle', text, '', '');\n          }\n\n          if (trimmedLable.length > 1) {\n            var border_1 = eventargs_1.border;\n\n            if (border_1['width'] > 1) {\n              var fill = eventargs_1.fill;\n              var opacity = dataLabelSettings.opacity;\n              var rx = dataLabelSettings.rx;\n              var ry = dataLabelSettings.ry;\n              var x = void 0;\n              var y = void 0;\n              var padding = 5;\n\n              if (zoomLabelsPosition && scaleZoomValue > 1 && !_this.maps.zoomNotApplied) {\n                x = location['x'] - textSize['width'] / 2;\n                y = location['y'] - textSize['height'] / 2 - padding;\n              } else {\n                x = (location['x'] + transPoint['x']) * scale - textSize['width'] / 2;\n                y = (location['y'] + transPoint['y']) * scale - textSize['height'] / 2;\n              }\n\n              var rectOptions = new RectOption(_this.maps.element.id + '_LayerIndex_' + layerIndex + '_shapeIndex_' + index + '_rectIndex_' + index, fill, border_1, opacity, new Rect(x, y, textSize['width'], textSize['height']), rx, ry);\n\n              var rect = _this.maps.renderer.drawRectangle(rectOptions);\n\n              group.appendChild(rect);\n            }\n          }\n\n          element = renderTextElement(options, style, style.color || _this.maps.themeStyle.dataLabelFontColor, group);\n\n          if (zoomLabelsPosition && scaleZoomValue > 1 && !_this.maps.zoomNotApplied) {\n            element.setAttribute('transform', 'translate( ' + location['x'] + ' ' + location['y'] + ' )');\n            location['x'] = locationX;\n            location['y'] = locationY;\n          } else {\n            element.setAttribute('transform', 'translate( ' + (location['x'] + transPoint.x) * scale + ' ' + ((location['y'] + transPoint.y) * scale + elementSize.height / 4) + ' )');\n          }\n\n          group.appendChild(element);\n        }\n\n        _this.dataLabelCollections.push({\n          location: {\n            x: location['x'],\n            y: location['y']\n          },\n          element: isNullOrUndefined(labelElement) ? element : labelElement,\n          layerIndex: layerIndex,\n          shapeIndex: sublayerIndexLabel ? oldIndex : index,\n          labelIndex: sublayerIndexLabel ? oldIndex : index,\n          dataLabelText: dataLabelText\n        });\n\n        if (labelTemplateElement.childElementCount > 0 && !_this.maps.element.contains(labelTemplateElement)) {\n          document.getElementById(_this.maps.element.id + '_Secondary_Element').appendChild(labelTemplateElement);\n        }\n      });\n    }\n  };\n\n  DataLabel.prototype.getPoint = function (shapes, points) {\n    shapes.map(function (current, index) {\n      points.push(new Point(current['point']['x'], current['point']['y']));\n    });\n    return points;\n  };\n  /**\n   * Get module name.\n   */\n\n\n  DataLabel.prototype.getModuleName = function () {\n    return 'DataLabel';\n  };\n  /**\n   * To destroy the layers.\n   * @return {void}\n   * @private\n   */\n\n\n  DataLabel.prototype.destroy = function (maps) {\n    /**\n     * Destroy method performed here\n     */\n  };\n\n  return DataLabel;\n}();\n\nexport { DataLabel };","map":{"version":3,"sources":["/Users/kristalduran/Desktop/PC3 Mapa/pc3-mapa/node_modules/@syncfusion/ej2-maps/src/maps/layers/data-label.js"],"names":["__rest","s","e","t","p","Object","prototype","hasOwnProperty","call","indexOf","getOwnPropertySymbols","i","length","findMidPointOfPolygon","Rect","filter","getTemplateFunction","getZoomTranslate","getTranslate","RectOption","convertElementFromLabel","Point","TextOption","renderTextElement","textTrim","measureText","Internalize","isNullOrUndefined","dataLabelRendering","DataLabel","maps","value","rightWidth","leftWidth","heightTop","heightBottom","dataLabelCollections","getDataLabel","dataSource","labelPath","shapeName","shapeDataPath","text","shapeNameValue","data","dataShapePathValue","isNaN","toLowerCase","toString","renderLabel","layer","layerIndex","shape","layerData","group","labelTemplateElement","index","intersect","_this","dataLabel","dataLabelSettings","style","textStyle","markerEle","templateFn","options","labelpath","shapePoint","midIndex","pointsLength","shapeData","element","datasrcObj","currentLength","oldIndex","location","sublayerIndexLabel","shapeProperties","labelId","id","textLocation","shapes","locationX","locationY","fontFamily","theme","themeStyle","labelFontFamily","properties","shapePropertyPath","propertyPath","isPoint","animate","animationDuration","zoomModule","translate","isTileMap","zoomSettings","zoomFactor","scale","transPoint","translatePoint","zoomTransPoint","zoomTranslatePoint","shapeWidth","scaleZoomValue","Math","floor","zoomLabelsPosition","enable","zoomShapeCollection","translateType","j","push","getPoint","layer_1","layerPoints","l","template","dataLabelText","projectionType","x","y","rightMin","rightMax","leftMin","leftMax","points","topMax","topMin","bottomMax","bottomMin","height","firstLevelMapLocation","zoomNotApplied","k","zoomLabelPositions","format","parseFloat","useGroupingSeparator","eventargs_1","name","cancel","border","datalabel","fill","isBlazor","blazorEventArgs","trigger","labelArgs","color","position","width","dataLabelShape","textSize","trimmedLable","elementSize","startY","endY","start","end","location1","xpositionEnds","xpositionStart","labelElement","templateElement","document","createElement","innerHTML","left","abs","baseMapRectBounds","top","appendChild","smartLabelMode","intersectionAction","difference","border_1","opacity","rx","ry","padding","rectOptions","rect","renderer","drawRectangle","dataLabelFontColor","setAttribute","shapeIndex","labelIndex","childElementCount","contains","getElementById","map","current","getModuleName","destroy"],"mappings":"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","sourcesContent":["var __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\n            t[p[i]] = s[p[i]];\n    return t;\n};\nimport { findMidPointOfPolygon, Rect, filter, getTemplateFunction, getZoomTranslate, getTranslate, RectOption, convertElementFromLabel, Point, TextOption, renderTextElement, textTrim, measureText, Internalize } from '../utils/helper';\nimport { isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { dataLabelRendering } from '../model/constants';\n/**\n * DataLabel Module used to render the maps datalabel\n */\nvar DataLabel = /** @class */ (function () {\n    function DataLabel(maps) {\n        this.value = { rightWidth: 0, leftWidth: 0, heightTop: 0, heightBottom: 0 };\n        this.maps = maps;\n        this.dataLabelCollections = [];\n    }\n    //tslint:disable:max-func-body-length\n    DataLabel.prototype.getDataLabel = function (dataSource, labelPath, shapeName, shapeDataPath) {\n        var text;\n        var shapeNameValue;\n        for (var i = 0; i < dataSource.length; i++) {\n            var data = dataSource[i];\n            var dataShapePathValue = void 0;\n            dataShapePathValue = !isNullOrUndefined(data[shapeDataPath]) && isNaN(data[shapeDataPath]) ?\n                data[shapeDataPath].toLowerCase() : data[shapeDataPath];\n            shapeName = !isNullOrUndefined(shapeName) ? shapeName.toString() : shapeName;\n            shapeNameValue = !isNullOrUndefined(shapeName) ? shapeName.toLowerCase() : shapeName;\n            if ((dataShapePathValue) === shapeNameValue) {\n                text = data;\n                break;\n            }\n        }\n        return text;\n    };\n    /**\n     * To render label for maps\n     * @param layer\n     * @param layerIndex\n     * @param shape\n     * @param layerData\n     * @param group\n     * @param labelTemplateElement\n     * @param index\n     */\n    DataLabel.prototype.renderLabel = function (layer, layerIndex, shape, layerData, group, labelTemplateElement, index, intersect) {\n        var _this = this;\n        var dataLabel = layer.dataLabelSettings;\n        var style = layer.dataLabelSettings.textStyle;\n        var markerEle;\n        var templateFn;\n        var options;\n        var dataLabelSettings = layer.dataLabelSettings;\n        var labelpath = layer.dataLabelSettings.labelPath;\n        var shapePoint = [[]];\n        var midIndex = 0;\n        var pointsLength = 0;\n        var shapeData = shape;\n        var element;\n        var data;\n        var text = '';\n        var datasrcObj;\n        var currentLength = 0;\n        var oldIndex;\n        var location;\n        var sublayerIndexLabel = false;\n        var shapeProperties = shape['properties'];\n        var labelId = this.maps.element.id + '_LayerIndex_' + layerIndex + '_shapeIndex_' + index + '_LabelIndex_' + index;\n        var textLocation = new Point(0, 0);\n        /* tslint:disable:no-string-literal */\n        var shapes = layerData[index];\n        var locationX;\n        var locationY;\n        style.fontFamily = this.maps.theme.toLowerCase() !== 'material' ? this.maps.themeStyle.labelFontFamily : style.fontFamily;\n        shape = shapes['property'];\n        var properties = (Object.prototype.toString.call(layer.shapePropertyPath) === '[object Array]' ?\n            layer.shapePropertyPath : [layer.shapePropertyPath]);\n        var propertyPath;\n        var isPoint = false;\n        var animate = layer.animationDuration !== 0 || isNullOrUndefined(this.maps.zoomModule);\n        var translate = (this.maps.isTileMap) ? new Object() : ((this.maps.zoomSettings.zoomFactor > 1 &&\n            !isNullOrUndefined(this.maps.zoomModule)) ? getZoomTranslate(this.maps, layer, animate) :\n            getTranslate(this.maps, layer, animate));\n        var scale = (this.maps.isTileMap) ? this.maps.scale : translate['scale'];\n        var transPoint = (this.maps.isTileMap) ? this.maps.translatePoint : translate['location'];\n        var zoomTransPoint = this.maps.zoomTranslatePoint;\n        var shapeWidth;\n        var scaleZoomValue = !isNullOrUndefined(this.maps.scale) ? Math.floor(this.maps.scale) : 1;\n        var zoomLabelsPosition = this.maps.zoomSettings.enable ? !isNullOrUndefined(this.maps.zoomShapeCollection) &&\n            this.maps.zoomShapeCollection.length > 0 : this.maps.zoomSettings.enable;\n        this.maps.translateType = 'labels';\n        for (var j = 0; j < properties.length; j++) {\n            if (shapeProperties[properties[j]]) {\n                propertyPath = properties[j];\n                datasrcObj = this.getDataLabel(layer.dataSource, layer.shapeDataPath, shapeData['properties'][propertyPath], layer.shapeDataPath);\n                if (datasrcObj) {\n                    break;\n                }\n            }\n        }\n        datasrcObj = this.getDataLabel(layer.dataSource, layer.shapeDataPath, shapeData['properties'][propertyPath], layer.shapeDataPath);\n        if (!isNullOrUndefined(shapes['property'])) {\n            shapePoint = [[]];\n            if (!layerData[index]['_isMultiPolygon'] && layerData[index]['type'] !== 'Point') {\n                shapePoint.push(this.getPoint(layerData[index], []));\n                currentLength = shapePoint[shapePoint.length - 1].length;\n                if (pointsLength < currentLength) {\n                    pointsLength = currentLength;\n                    midIndex = shapePoint.length - 1;\n                }\n            }\n            else {\n                var layer_1 = layerData[index];\n                if (layer_1['type'] === 'Point') {\n                    isPoint = true;\n                    var layerPoints = [];\n                    layerPoints.push(this.getPoint(layerData, []));\n                    shapePoint = layerPoints;\n                    currentLength = shapePoint[shapePoint.length - 1].length;\n                    if (pointsLength < currentLength) {\n                        pointsLength = currentLength;\n                        midIndex = shapePoint.length - 1;\n                    }\n                }\n                for (var j = 0; j < layer_1.length; j++) {\n                    shapePoint.push(this.getPoint(layer_1[j], []));\n                    currentLength = shapePoint[shapePoint.length - 1].length;\n                    if (pointsLength < currentLength) {\n                        pointsLength = currentLength;\n                        midIndex = shapePoint.length - 1;\n                    }\n                }\n            }\n        }\n        text = (!isNullOrUndefined(datasrcObj)) ? !isNullOrUndefined(datasrcObj[labelpath]) ?\n            datasrcObj[layer.shapeDataPath].toString() : datasrcObj[layer.shapeDataPath] : shapeData['properties'][labelpath];\n        if ((Object.prototype.toString.call(layer.shapePropertyPath) === '[object Array]') &&\n            (isNullOrUndefined(text) && layer.dataSource['length'] === 0)) {\n            for (var l = 0; l < layer.shapePropertyPath.length; l++) {\n                if (shapeData['properties'][layer.shapePropertyPath[l]]) {\n                    text = shapeData['properties'][layer.shapePropertyPath[l]];\n                    break;\n                }\n            }\n        }\n        if (isNullOrUndefined(text) && (layer.dataLabelSettings.template !== \"\" && layer.dataSource['length'] === 0)) {\n            text = shapeData['properties'][layer.shapePropertyPath];\n        }\n        var dataLabelText = text;\n        var projectionType = this.maps.projectionType;\n        if (isPoint) {\n            location = {\n                x: shapePoint[midIndex][index]['x'], y: shapePoint[midIndex][index]['y'],\n                rightMin: 0, rightMax: 0, leftMin: 0, leftMax: 0,\n                points: shapePoint[midIndex][index], topMax: 0, topMin: 0,\n                bottomMax: 0, bottomMin: 0, height: 0\n            };\n        }\n        else {\n            location = findMidPointOfPolygon(shapePoint[midIndex], projectionType);\n        }\n        var firstLevelMapLocation = location;\n        if (!isNullOrUndefined(text) && !isNullOrUndefined(location)) {\n            if (zoomLabelsPosition && scaleZoomValue > 1 && !this.maps.zoomNotApplied && dataLabel.template === '') {\n                if (layerIndex > 0) {\n                    for (var k = 0; k < this.maps.zoomLabelPositions.length; k++) {\n                        if (this.maps.zoomLabelPositions[k]['dataLabelText'] === text) {\n                            oldIndex = index;\n                            index = k;\n                            sublayerIndexLabel = true;\n                            break;\n                        }\n                    }\n                }\n                locationX = location['x'];\n                locationY = location['y'];\n                location['x'] = ((location['x'] + zoomTransPoint['x']) * scale);\n                location['y'] = ((location['y'] + zoomTransPoint['y']) * scale);\n            }\n            location['y'] = (this.maps.projectionType === 'Mercator') ? location['y'] : (-location['y']);\n            data = location;\n            if (!isNullOrUndefined(this.maps.format) && !isNaN(parseFloat(text))) {\n                if (this.maps.useGroupingSeparator) {\n                    text = Internalize(this.maps, parseFloat(text));\n                    if (!isNullOrUndefined(datasrcObj)) {\n                        datasrcObj[labelpath] = text;\n                    }\n                }\n            }\n            var eventargs_1 = {\n                name: dataLabelRendering, maps: this.maps, cancel: false, border: dataLabel.border, datalabel: dataLabel,\n                fill: dataLabel.fill, template: dataLabel.template, text: text\n            };\n            if (this.maps.isBlazor) {\n                var maps = eventargs_1.maps, datalabel = eventargs_1.datalabel, blazorEventArgs = __rest(eventargs_1, [\"maps\", \"datalabel\"]);\n                eventargs_1 = blazorEventArgs;\n            }\n            this.maps.trigger('dataLabelRendering', eventargs_1, function (labelArgs) {\n                if (eventargs_1.cancel) {\n                    return;\n                }\n                var border = { color: 'yellow' };\n                var position = [];\n                var width = zoomLabelsPosition && scaleZoomValue > 1 && !_this.maps.zoomNotApplied\n                    && _this.maps.zoomShapeCollection.length > index ? _this.maps.zoomShapeCollection[index]['width'] :\n                    (location['rightMax']['x'] - location['leftMax']['x']) * scale;\n                if (!isNullOrUndefined(_this.maps.dataLabelShape)) {\n                    shapeWidth = firstLevelMapLocation['rightMax']['x'] - firstLevelMapLocation['leftMax']['x'];\n                    _this.maps.dataLabelShape.push(shapeWidth);\n                }\n                if (eventargs_1.text !== text && !eventargs_1.cancel) {\n                    text = eventargs_1.text;\n                }\n                var textSize = measureText(text, style);\n                var trimmedLable = text;\n                var elementSize = textSize;\n                var startY = location['y'] - textSize['height'] / 4;\n                var endY = location['y'] + textSize['height'] / 4;\n                var start = ((location['y'] + transPoint['y']) * scale) - textSize['height'] / 4;\n                var end = ((location['y'] + transPoint['y']) * scale) + textSize['height'] / 4;\n                position = filter(shapePoint[midIndex], startY, endY);\n                if (!isPoint && position.length > 5 && (shapeData['geometry']['type'] !== 'MultiPolygon') &&\n                    (shapeData['type'] !== 'MultiPolygon')) {\n                    var location1 = findMidPointOfPolygon(position, projectionType);\n                    if (zoomLabelsPosition && scaleZoomValue > 1 && !_this.maps.zoomNotApplied && eventargs_1.template === '') {\n                        location1['x'] = ((_this.maps.zoomLabelPositions[index]['location']['x'] + zoomTransPoint['x']) * scale);\n                        location1['y'] = ((_this.maps.zoomLabelPositions[index]['location']['y'] + zoomTransPoint['y']) * scale);\n                    }\n                    locationX = location1['x'];\n                    location['x'] = location1['x'];\n                    width = zoomLabelsPosition && scaleZoomValue > 1 && !_this.maps.zoomNotApplied\n                        && _this.maps.zoomShapeCollection.length > index ? _this.maps.zoomShapeCollection[index]['width'] :\n                        (location1['rightMax']['x'] - location1['leftMax']['x']) * scale;\n                }\n                var xpositionEnds = ((location['x'] + transPoint['x']) * scale) + textSize['width'] / 2;\n                var xpositionStart = ((location['x'] + transPoint['x']) * scale) - textSize['width'] / 2;\n                _this.value[index] = { rightWidth: xpositionEnds, leftWidth: xpositionStart, heightTop: start, heightBottom: end };\n                var labelElement;\n                if (eventargs_1.template !== '') {\n                    templateFn = getTemplateFunction(eventargs_1.template);\n                    var templateElement = templateFn ? templateFn(!isNullOrUndefined(datasrcObj) ?\n                        datasrcObj : shapeData['properties'], null, null, _this.maps.element.id + '_LabelTemplate', false) : document.createElement('div');\n                    templateElement.innerHTML = !templateFn ? eventargs_1.template : '';\n                    labelElement = convertElementFromLabel(templateElement, labelId, !isNullOrUndefined(datasrcObj) ? datasrcObj : shapeData['properties'], index, _this.maps);\n                    labelElement.style.left = ((Math.abs(_this.maps.baseMapRectBounds['min']['x'] - location['x'])) * scale) + 'px';\n                    labelElement.style.top = ((Math.abs(_this.maps.baseMapRectBounds['min']['y'] - location['y'])) * scale) + 'px';\n                    labelTemplateElement.appendChild(labelElement);\n                }\n                else {\n                    if (dataLabelSettings.smartLabelMode === 'Trim') {\n                        trimmedLable = textTrim(width, text, style);\n                        elementSize = measureText(trimmedLable, style);\n                        options = new TextOption(labelId, textLocation.x, textLocation.y, 'middle', trimmedLable, '', '');\n                    }\n                    if (dataLabelSettings.smartLabelMode === 'None') {\n                        options = new TextOption(labelId, (textLocation.x), textLocation.y, 'middle', text, '', '');\n                    }\n                    if (dataLabelSettings.smartLabelMode === 'Hide') {\n                        text = (width >= textSize['width']) ? text : '';\n                        options = new TextOption(labelId, (textLocation.x), (textLocation.y), 'middle', text, '', '');\n                    }\n                    text = options['text'];\n                    if (dataLabelSettings.intersectionAction === 'Hide') {\n                        for (var i = 0; i < intersect.length; i++) {\n                            if (!isNullOrUndefined(intersect[i])) {\n                                if (_this.value[index]['leftWidth'] > intersect[i]['rightWidth']\n                                    || _this.value[index]['rightWidth'] < intersect[i]['leftWidth']\n                                    || _this.value[index]['heightTop'] > intersect[i]['heightBottom']\n                                    || _this.value[index]['heightBottom'] < intersect[i]['heightTop']) {\n                                    text = text;\n                                }\n                                else {\n                                    text = '';\n                                    break;\n                                }\n                            }\n                        }\n                        intersect.push(_this.value[index]);\n                        options = new TextOption(labelId, textLocation.x, textLocation.y, 'middle', text, '', '');\n                    }\n                    var difference = void 0;\n                    if (dataLabelSettings.intersectionAction === 'Trim') {\n                        for (var j = 0; j < intersect.length; j++) {\n                            if (!isNullOrUndefined(intersect[j])) {\n                                if (intersect[j]['rightWidth'] < _this.value[index]['leftWidth']\n                                    || intersect[j]['leftWidth'] > _this.value[index]['rightWidth']\n                                    || intersect[j]['heightBottom'] < _this.value[index]['heightTop']\n                                    || intersect[j]['heightTop'] > _this.value[index]['heightBottom']) {\n                                    trimmedLable = text;\n                                    difference = 0;\n                                }\n                                else {\n                                    if (_this.value[index]['leftWidth'] > intersect[j]['leftWidth']) {\n                                        width = intersect[j]['rightWidth'] - _this.value[index]['leftWidth'];\n                                        difference = width - (_this.value[index]['rightWidth'] - _this.value[index]['leftWidth']);\n                                        trimmedLable = textTrim(difference, text, style);\n                                        break;\n                                    }\n                                    if (_this.value[index]['leftWidth'] < intersect[j]['leftWidth']) {\n                                        width = _this.value[index]['rightWidth'] - intersect[j]['leftWidth'];\n                                        difference = Math.abs(width - (_this.value[index]['rightWidth'] - _this.value[index]['leftWidth']));\n                                        trimmedLable = textTrim(difference, text, style);\n                                        break;\n                                    }\n                                }\n                            }\n                        }\n                        elementSize = measureText(trimmedLable, style);\n                        intersect.push(_this.value[index]);\n                        options = new TextOption(labelId, textLocation.x, (textLocation.y), 'middle', trimmedLable, '', '');\n                    }\n                    if (dataLabelSettings.intersectionAction === 'None') {\n                        options = new TextOption(labelId, (textLocation.x), (textLocation.y), 'middle', text, '', '');\n                    }\n                    if (trimmedLable.length > 1) {\n                        var border_1 = eventargs_1.border;\n                        if (border_1['width'] > 1) {\n                            var fill = eventargs_1.fill;\n                            var opacity = dataLabelSettings.opacity;\n                            var rx = dataLabelSettings.rx;\n                            var ry = dataLabelSettings.ry;\n                            var x = void 0;\n                            var y = void 0;\n                            var padding = 5;\n                            if (zoomLabelsPosition && scaleZoomValue > 1 && !_this.maps.zoomNotApplied) {\n                                x = ((location['x'])) - textSize['width'] / 2;\n                                y = ((location['y'])) - textSize['height'] / 2 - padding;\n                            }\n                            else {\n                                x = ((location['x'] + transPoint['x']) * scale) - textSize['width'] / 2;\n                                y = ((location['y'] + transPoint['y']) * scale) - textSize['height'] / 2;\n                            }\n                            var rectOptions = new RectOption(_this.maps.element.id + '_LayerIndex_' + layerIndex + '_shapeIndex_' + index + '_rectIndex_' + index, fill, border_1, opacity, new Rect(x, y, textSize['width'], textSize['height']), rx, ry);\n                            var rect = _this.maps.renderer.drawRectangle(rectOptions);\n                            group.appendChild(rect);\n                        }\n                    }\n                    element = renderTextElement(options, style, style.color || _this.maps.themeStyle.dataLabelFontColor, group);\n                    if (zoomLabelsPosition && scaleZoomValue > 1 && !_this.maps.zoomNotApplied) {\n                        element.setAttribute('transform', 'translate( ' + ((location['x'])) + ' '\n                            + (((location['y']))) + ' )');\n                        location['x'] = locationX;\n                        location['y'] = locationY;\n                    }\n                    else {\n                        element.setAttribute('transform', 'translate( ' + ((location['x'] + transPoint.x) * scale) + ' '\n                            + (((location['y'] + transPoint.y) * scale) + (elementSize.height / 4)) + ' )');\n                    }\n                    group.appendChild(element);\n                }\n                _this.dataLabelCollections.push({\n                    location: { x: location['x'], y: location['y'] },\n                    element: isNullOrUndefined(labelElement) ? element : labelElement,\n                    layerIndex: layerIndex,\n                    shapeIndex: sublayerIndexLabel ? oldIndex : index,\n                    labelIndex: sublayerIndexLabel ? oldIndex : index,\n                    dataLabelText: dataLabelText\n                });\n                if (labelTemplateElement.childElementCount > 0 && !_this.maps.element.contains(labelTemplateElement)) {\n                    document.getElementById(_this.maps.element.id + '_Secondary_Element').appendChild(labelTemplateElement);\n                }\n            });\n        }\n    };\n    DataLabel.prototype.getPoint = function (shapes, points) {\n        shapes.map(function (current, index) {\n            points.push(new Point(current['point']['x'], current['point']['y']));\n        });\n        return points;\n    };\n    /**\n     * Get module name.\n     */\n    DataLabel.prototype.getModuleName = function () {\n        return 'DataLabel';\n    };\n    /**\n     * To destroy the layers.\n     * @return {void}\n     * @private\n     */\n    DataLabel.prototype.destroy = function (maps) {\n        /**\n         * Destroy method performed here\n         */\n    };\n    return DataLabel;\n}());\nexport { DataLabel };\n"]},"metadata":{},"sourceType":"module"}